{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="jumbotron" style="background-image: url('/static/images/main-background.png'); background-position: 95% center;  background-repeat: no-repeat; background-size: 15%;" >
  <div style="margin-left: 100px;">
    <h1 class="display-4"><b>Welcome to <b style='font-weight:700'>VaccineDynamic</b></b></h1>
    <h5 class="lead" style="margin-top: 25px">Vaccine Cost-effectiveness Prediction Model</h5>
    <hr/>

    Designed and maintained by
    <b>Institute of Epidemiology and Preventive Medicine, National Taiwan University
    </b>
    <br/>
  </div>
</div>
<!-- <img src="{% static "images/pathogen_workflow.png" %}" alt="My image" style="width:100%"> -->


<div style="margin: 40px">



  <div class="row" id="chart_pannel" style="margin-left: 40px">
    <div class="chart-container" style="width:30vw; height:300px">
      <canvas id="totalInfected"></canvas>
    </div>

    <div class="chart-container" style="width:30vw; height:300px">
      <canvas id="currentInfected"></canvas>
    </div>

    <div class="chart-container" style="width:30vw; height:300px">
      <canvas id="newInfected"></canvas>
    </div>


    <div class="chart-container" style="width:45vw; height:300px">
      <canvas id="totalDeath"></canvas>
    </div>

    <div class="chart-container" style="width:45vw; height:300px">
      <canvas id="newDeath"></canvas>
    </div>

    <div class="chart-container" style="width:45vw; height:300px">
      <canvas id="totalRecovery"></canvas>
    </div>

    <div class="chart-container" style="width:45vw; height:300px">
      <canvas id="newRecovery"></canvas>
    </div>

    <div class="chart-container" style="width:45vw; height:300px">
      <canvas id="totalReachDay"></canvas>
    </div>

    <div class="chart-container" style="width:45vw; height:300px">
      <canvas id="newReachDay"></canvas>
    </div>
  </div>


  <script>
    console.log("analysis_code: ", "{{analysis_code}}")
    function setChart(data, chart_id) {
      var ctx = document.getElementById(chart_id);
      if (chart_id == "totalInfected") {
        var backgroundColor = 'rgba(255, 99, 132, 0.2)'
        var borderColor = 'rgba(255,99,132,1)'
        var label = "Total Infected"
      } else if (chart_id == "currentInfected") {
        var backgroundColor = 'rgba(255, 99, 132, 0.2)'
        var borderColor = 'rgba(255,99,132,1)'
        var label = "Current Infected"
      } else if (chart_id == "newInfected") {
        var backgroundColor = 'rgba(255, 99, 132, 0.2)'
        var borderColor = 'rgba(255,99,132,1)'
        var label = "New Infected"
      } else if (chart_id == "newDeath") {
        var backgroundColor = 'rgba(54, 162, 235, 0.2)'
        var borderColor = 'rgba(54, 162, 235, 1)'
        var label = "New Death"
      } else if (chart_id == "totalDeath") {
        var backgroundColor = 'rgba(54, 162, 235, 0.2)'
        var borderColor = 'rgba(54, 162, 235, 1)'
        var label = "Total Death"
      } else if (chart_id == "totalRecovery") {
        var backgroundColor = 'rgba(255, 206, 86, 0.2)'
        var borderColor = 'rgba(255, 206, 86, 1)'
        var label = "Total Recovery"
      } else if (chart_id == "newRecovery") {
        var backgroundColor = 'rgba(255, 206, 86, 0.2)'
        var borderColor = 'rgba(255, 206, 86, 1)'
        var label = "New Recovery"
      } else if (chart_id == "totalReachDay") {
        var backgroundColor = 'rgba(75, 192, 192, 0.2)'
        var borderColor = 'rgba(75, 192, 192, 1)'
        var label = "Total Patients Reached Transmission Days"
      } else if (chart_id == "newReachDay") {
        var backgroundColor = 'rgba(75, 192, 192, 0.2)'
        var borderColor = 'rgba(75, 192, 192, 1)'
        var label = "New Patients Reached Transmission Days"
      }
      var mychart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.labels,
           datasets: [{
               label: label,
               data: data[chart_id+"_sz"],
               backgroundColor: [
                  backgroundColor
               ],
              borderColor: [
                  borderColor
              ],
              borderWidth: 1
            }]
          },
          options: {
              responsive:true,
              maintainAspectRatio: false,
              scales: {
                  yAxes: [{
                      ticks: {
                          beginAtZero:true
                      }
                  }]
              }
          }
      });
    }

    var current_data = {}
    var update_data = {}
    var button_bool = true
    console.log("current_data.data: ", current_data.data)
    console.log("update_data.data: ", update_data.data)
    console.log("'api-data/{{analysis_code}}',: ", 'api-data/{{analysis_code}}')
    $.ajax({
        method: 'GET',
        url: 'api-data/{{analysis_code}}',
        success: function(data){
            console.log("Initial analysis_code: ", "{{analysis_code}}")
            current_data = Object.assign({}, data);
            update_data = Object.assign({}, data);
            setChart(current_data, "totalInfected");
            setChart(current_data, "currentInfected");
            setChart(current_data, "newInfected");
            setChart(current_data, "totalDeath");
            setChart(current_data, "newDeath");
            setChart(current_data, "totalRecovery");
            setChart(current_data, "newRecovery");
            setChart(current_data, "totalReachDay");
            setChart(current_data, "newReachDay");
        },
        error: function(error_data){
          console.log("Initial analysis_code: ", "api-data/{{analysis_code}}")
          console.log('error');
        }
    })


    setInterval(function(){
      $.ajax({
          method: 'GET',
          url: 'api-data/{{analysis_code}}',
          success: function(data){
              console.log("update analysis_code: ", "{{analysis_code}}")
              console.log("task_status: ", data.task_status)
              update_data = Object.assign({}, data);
              button_bool = current_data.analysis_code == "Empty"
              console.log("button_bool: ", button_bool)
              console.log("current_data: ", data['totalInfected_sz'])
              if (!button_bool) {
                var btn = document.getElementById('button_insert');
                if (btn != null) {
                  btn.remove();
                }
              }
              if (update_data) {
                // Start from here tomorrow
              }
          },
          error: function(error_data){
            console.log('error {{analysis_code}}');
          }
      })
      if (JSON.stringify(current_data) != JSON.stringify(update_data)) {
        current_data = Object.assign({}, update_data);
        setChart(current_data, "totalInfected");
        setChart(current_data, "currentInfected");
        setChart(current_data, "newInfected");
        setChart(current_data, "totalDeath");
        setChart(current_data, "newDeath");
        setChart(current_data, "totalRecovery");
        setChart(current_data, "newRecovery");
        setChart(current_data, "totalReachDay");
        setChart(current_data, "newReachDay");
      }
    }, 1000)

  </script>


  <form enctype="multipart/form-data" required="True" method="post">
      {% csrf_token %}
      {{ form }}
      <!-- <input class="form-control" type="number" value="5000" name="try_" id="try_"> -->

      <div id="button_insert">
        <input type="submit" id="run_model" name="run_model" class="btn btn-success btn-lg btn-block" value="Run the Model" style="margin-bottom: 50px">
      </div>
      <!-- {% if button_bool %}
      {% else %}
      {% endif %} -->
  <!-- </form>


  <!-- <form enctype="multipart/form-data" required="True" method="post">
      {% csrf_token %}
      {{ form }} -->
    <h4 style="margin-bottom:20px"><i class="fa fa-dot-circle"></i> &nbsp; Basic Model Parameters</h4>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="BMP_IDX_CASE_NUM" class="col-7 col-form-label">Idex case number</label>
          <div class="col-5">
            <input class="form-control" type="number" value="5000" id="BMP_IDX_CASE_NUM" name="BMP_IDX_CASE_NUM">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="BMP_SIMULATION_DAY" class="col-7 col-form-label">Simulation day</label>
          <div class="col-5">
            <input class="form-control" type="number" value="12" id="BMP_SIMULATION_DAY" name="BMP_SIMULATION_DAY">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="BMP_SIMULATION_TIME" class="col-7 col-form-label">Simulation times</label>
          <div class="col-5">
            <input class="form-control" type="number" value="1000" id="BMP_SIMULATION_TIME">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="BMP_CYCLE_DAYS" class="col-7 col-form-label">Cycle days</label>
          <div class="col-5">
            <input class="form-control" type="number" value="7" id="BMP_CYCLE_DAYS">
          </div>
        </div>
      </div>
    </div>
    <hr>

    <h4 style="margin-bottom:20px"><i class="fa fa-dot-circle"></i> &nbsp; Age Group Percentage</h4>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="AGP_YOUTH_GRP" class="col-7 col-form-label"> ≤ 18 </label>
          <div class="col-5">
            <input class="form-control" type="number" value="5000" id="AGP_YOUTH_GRP">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="AGP_ADULT_GRP" class="col-7 col-form-label"> 19 - 64  </label>
          <div class="col-5">
            <input class="form-control" type="number" value="180" id="AGP_ADULT_GRP">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="AGP_ELDER_GRP" class="col-7 col-form-label">  ≥ 65 </label>
          <div class="col-5">
            <input class="form-control" type="number" value="1000" id="AGP_ELDER_GRP">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
    </div>
    <br>


    <h4 style="margin-bottom:20px"><i class="fa fa-dot-circle"></i> &nbsp; Contact Rate</h4>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="CR_SAME_GRP" class="col-7 col-form-label"> Same age group </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.6" id="CR_SAME_GRP">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="CR_DIFF_GRP" class="col-7 col-form-label"> Different age group  </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.2" id="CR_DIFF_GRP">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
      <div class="col">
      </div>
    </div>
    <br>

    <h4 style="margin-bottom:20px"><i class="fa fa-dot-circle"></i> &nbsp; Vaccine Rate</h4>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="VR_YOUTH_RT" class="col-7 col-form-label"> ≤ 18 </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.646" id="VR_YOUTH_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="VR_ADULT_RT" class="col-7 col-form-label"> 19 - 64  </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.093" id="VR_ADULT_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="VR_ELDER_RT" class="col-7 col-form-label">  ≥ 65 </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.445" id="VR_ELDER_RT">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
    </div>
    <br>

    <h4 style="margin-bottom:20px"><i class="fa fa-dot-circle"></i> &nbsp; Infection Rate</h4>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="IR_YOUTH_V_RT" class="col-7 col-form-label"> ≤ 18 with vaccine </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.646" id="IR_YOUTH_V_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="IR_ADULT_V_RT" class="col-7 col-form-label"> 19 - 64 with vaccine </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.093" id="IR_ADULT_V_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="IR_ELDER_V_RT" class="col-7 col-form-label">  ≥ 65 with vaccine</label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.445" id="IR_ELDER_V_RT">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="IR_YOUTH_NV_RT" class="col-7 col-form-label"> ≤ 18 no vaccine </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.646" id="IR_YOUTH_NV_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="IR_ADULT_NV_RT" class="col-7 col-form-label"> 19 - 64 no vaccine </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.093" id="IR_ADULT_NV_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="IR_ELDER_NV_RT" class="col-7 col-form-label">  ≥ 65 no vaccine</label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.445" id="IR_ELDER_NV_RT">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
    </div>
    <br>


    <h4 style="margin-bottom:20px"><i class="fa fa-dot-circle"></i> &nbsp; Medicine Intake Rate</h4>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="MIR_YOUTH_RT" class="col-7 col-form-label"> ≤ 18 </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.646" id="MIR_YOUTH_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="MIR_ADULT_RT" class="col-7 col-form-label"> 19 - 64  </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.093" id="MIR_ADULT_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="MIR_ELDER_RT" class="col-7 col-form-label">  ≥ 65 </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.445" id="MIR_ELDER_RT">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
    </div>
    <br>

    <h4 style="margin-bottom:20px"><i class="fa fa-dot-circle"></i> &nbsp; Severe Rate</h4>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="SR_YOUTH_48_RT" class="col-7 col-form-label"> ≤ 18 with medicine </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.646" id="SR_YOUTH_48_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="SR_ADULT_48_RT" class="col-7 col-form-label"> 19 - 64 with medicine </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.093" id="SR_ADULT_48_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="SR_ELDER_48_RT" class="col-7 col-form-label">  ≥ 65 with medicine</label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.445" id="SR_ELDER_48_RT">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="SR_YOUTH_N48_RT" class="col-7 col-form-label"> ≤ 18 no medicine </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.646" id="SR_YOUTH_N48_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="SR_ADULT_N48_RT" class="col-7 col-form-label"> 19 - 64 no medicine </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.093" id="SR_ADULT_N48_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="SR_ELDER_N48_RT" class="col-7 col-form-label">  ≥ 65 no medicine</label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.445" id="SR_ELDER_N48_RT">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
    </div>
    <br>


    <h4 style="margin-bottom:20px"><i class="fa fa-dot-circle"></i> &nbsp; Fatality Rate</h4>
    <div class="row">
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="FR_YOUTH_RT" class="col-7 col-form-label"> ≤ 18 </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.646" id="FR_YOUTH_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="FR_ADULT_RT" class="col-7 col-form-label"> 19 - 64  </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.093" id="FR_ADULT_RT">
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group row">
          <label style="text-align: right" for="FR_ELDER_RT" class="col-7 col-form-label">  ≥ 65 </label>
          <div class="col-5">
            <input class="form-control" type="number" value="0.445" id="FR_ELDER_RT">
          </div>
        </div>
      </div>
      <div class="col">
      </div>
    </div>
    <br>
<!--
    <input type="submit" id="parameters_submit_btn" name="parameters_submit_btn" class="btn btn-success btn-lg btn-block" value="Set Parameters" style="margin-bottom: 50px"> -->

  </form>
</div>

<!-- class FatalityRate(Enum):
    YOUTH_RT = 0.12
    ADULT_RT = 0.14
    ELDER_RT = 0.14

class effectiveness(Enum):
    MILD = (-0.88)*7/365
    SEVERE = (-0.88)*7/365 + (-0.98)*5.4/365
    DEATH = (-0.88)*7/365 + (-0.98)*5.4/365 + (-1)*(HEALTH_LIFE_EXP-SEVERE_AVG_DEATH_AGE)

class VaccineExpen(Enum):
    YOUTH_TRIVALENT_VAC = 500
    ADULT_TRIVALENT_VAC = 500
    ELDER_TRIVALENT_VAC = 500
    YOUTH_HIGH_DOSE_VAC = 0
    ADULT_HIGH_DOSE_VAC = 0
    ELDER_HIGH_DOSE_VAC = 1656
    YOUTH_ADJUVANTED_VAC = 0
    ADULT_ADJUVANTED_VAC = 0
    ELDER_ADJUVANTED_VAC = 1696

class HealthExpen(Enum):
    YOUTH_OUTPATIENT = 371
    ADULT_OUTPATIENT = 372
    ELDER_OUTPATIENT = 401
    YOUTH_ANTI_VIRUS = 950
    ADULT_ANTI_VIRUS = 950
    ELDER_ANTI_VIRUS = 950
    YOUTH_HOSPITALIZED = 45935
    ADULT_HOSPITALIZED = 45935
    ELDER_HOSPITALIZED = 45935



More:
HEALTH_LIFE_EXP = 71.2
SEVERE_AVG_DEATH_AGE = 40
IDX_SEEK_TREATMENT_PROB = 0.1 -->




<!-- <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
    </ol>
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="{% static "images/phylo_tree.png" %}" alt="Slide show - 1 (Maybe we can put current tree)" class="d-block w-100"  height="400" width="42" style="background-image: url('/static/images/main-background.png'); background-position: center center;  background-repeat: no-repeat;">
        </div>
        <div class="carousel-item">
            <img src="{% static "images/workflow.png" %}" alt="Slide show - 2 (Maybe we can put workflow)" class="d-block w-100"  height="400" width="42" style="background-image: url('/static/images/main-background.png'); background-position: center center;  background-repeat: no-repeat;">
        </div>
        <div class="carousel-item">
            <img src="{% static "images/Others.jpg" %}" alt="Slide show - 3 (Others)" class="d-block w-100"  height="400" width="42" style="background-image: url('/static/images/main-background.png'); background-position: center center;  background-repeat: no-repeat;">
        </div>
    </div>
    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
</div> -->
{% endblock content %}
